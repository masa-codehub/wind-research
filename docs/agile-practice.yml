アジャイル要求リスト:
  エピック候補:
    - id: "EPIC-01"
      title: "コマンドラインインターフェースと実行制御"
      description: "ユーザーがコマンドラインからシステムを操作し、パラメータを指定して処理を実行・制御できるようにする。"
    - id: "EPIC-02"
      title: "気象庁データ取得とHTML解析"
      description: "指定された条件に基づき、気象庁ウェブサイトから風況データを取得し、必要な情報を抽出する。"
    - id: "EPIC-03"
      title: "データ変換とビジネスロジック"
      description: "抽出した生データを分析に適した形式（数値化された風向・風速など）に変換し、ドメインルールを適用する。"
    - id: "EPIC-04"
      title: "データ統合とCSV出力"
      description: "処理されたデータを期間分統合し、定義されたCSV形式でファイルに出力する。"
    - id: "EPIC-05"
      title: "運用支援とユーザビリティ"
      description: "処理中の進捗表示、エラーハンドリング、ログ出力など、ユーザーが安心してシステムを利用できるための機能。"
    - id: "EPIC-06"
      title: "システム基盤と品質保証"
      description: "Docker環境構築、非機能要件（性能、保守性、テスト容易性など）の担保、技術的負債の管理。"

  ユーザーストーリー:
    - US_ID: "US-001"
      ユーザーストーリー: "データ利用者として、コマンドラインから必須パラメータ（観測地点、期間）を指定して風況データ収集処理を開始したい。それは、特定の条件のデータを手軽に取得するためだ。"
      受け入れ基準:
        - "AC-001-01: コマンドラインで都道府県番号、地点番号、開始年月日、取得期間（日数または終了年月日）を指定してスクリプトを実行できる。"
        - "AC-001-02: 指定された必須パラメータが正しく解釈され、データ取得処理が開始される。"
        - "AC-001-03: 必須パラメータのいずれかが欠けている場合、適切なエラーメッセージが表示され、処理は開始されない。"
        - "AC-001-04: パラメータの型やフォーマットが不正な場合（例：日付が不正）、エラーメッセージが表示され、処理は開始されない。"
      参照元要件ID: "FR-001-01, FR-001-03, UC-001 (基本フロー1,2)"
      関連エピック: "EPIC-01"
      関連レイヤー（推測）: "[レイヤー: Adapter-CUI], [レイヤー: UseCase]"
      規模感（推測）: "[SP: 3]"
      依存先（推測）: "TASK-001"
      備考: null

    - US_ID: "US-002"
      ユーザーストーリー: "データ利用者として、コマンドラインからオプションパラメータ（データ取得間隔、出力ファイルパス）を指定したい。それは、取得プロセスをカスタマイズし、出力結果を管理しやすくするためだ。"
      受け入れ基準:
        - "AC-002-01: データ取得間隔（秒数）をオプションで指定でき、システムはその間隔（下限3秒）を遵守する。指定がない場合はデフォルト5秒で動作する。"
        - "AC-002-02: データ取得間隔が3秒未満で指定された場合、エラーメッセージを表示し処理を開始しない。"
        - "AC-002-03: 出力CSVファイルパスをオプションで指定でき、処理結果がそのパスに保存される。指定がない場合はデフォルトの命名規則とパスで保存される。"
      参照元要件ID: "FR-001-02, FR-002-03"
      関連エピック: "EPIC-01"
      関連レイヤー（推測）: "[レイヤー: Adapter-CUI], [レイヤー: UseCase], [レイヤー: Infrastructure]"
      規模感（推測）: "[SP: 2]"
      依存先（推測）: "US-001"
      備考: null

    - US_ID: "US-003"
      ユーザーストーリー: "データ利用者として、コマンドラインオプションでツールのヘルプ情報を表示したい。それは、ツールの使い方や指定可能なパラメータを簡単に確認するためだ。"
      受け入れ基準:
        - "AC-003-01: -h または --help オプションを指定して実行すると、利用可能なコマンドライン引数、オプション、およびそれらの説明がCUIに表示される。"
        - "AC-003-02: ヘルプメッセージ表示後は、データ取得処理は実行されない。"
      参照元要件ID: "FR-001-04"
      関連エピック: "EPIC-01"
      関連レイヤー（推測）: "[レイヤー: Adapter-CUI]"
      規模感（推測）: "[SP: 1]"
      依存先（推測）: null
      備考: null

    - US_ID: "US-004"
      ユーザーストーリー: "システムとして、指定された観測地点と日付に基づき、気象庁ウェブサイトの正しいURLを動的に生成したい。それは、該当する風況データページへ確実にアクセスするためだ。"
      受け入れ基準:
        - "AC-004-01: 入力された都道府県番号、地点番号、年月日を基に、気象庁の風況データページのURLが正しく組み立てられる。"
        - "AC-004-02: 期間指定（例: 2024年1月1日から3日間）の場合、各日付（2024-01-01, 2024-01-02, 2024-01-03）に対応するURLが順次生成される。"
      参照元要件ID: "FR-002-01, UC-001 (基本フロー4a)"
      関連エピック: "EPIC-02"
      関連レイヤー（推測）: "[レイヤー: UseCase], [レイヤー: Adapter-Web]"
      規模感（推測）: "[SP: 1]"
      依存先（推測）: "US-001"
      備考: null

    - US_ID: "US-005"
      ユーザーストーリー: "システムとして、生成したURLから気象庁ウェブサイトのHTMLコンテンツを、指定された間隔を空けて取得したい。それは、風況データを抽出し、かつサイトに負荷をかけないためだ。"
      受け入れ基準:
        - "AC-005-01: 指定されたURLに対してHTTP GETリクエストが送信され、HTMLコンテンツが取得できる。"
        - "AC-005-02: 連続して複数日のデータを取得する際、各リクエストの送信前に指定されたデータ取得間隔（デフォルト5秒、下限3秒）の待機時間が入る。"
        - "AC-005-03: HTML取得時にネットワークエラーやHTTPエラーが発生した場合、エラーをログに記録し、該当日の処理はスキップされる（リトライはしない）。"
      参照元要件ID: "FR-002-02, FR-002-03, FR-002-04, UC-001 (基本フロー4b, 代替フロー5.2)"
      関連エピック: "EPIC-02"
      関連レイヤー（推測）: "[レイヤー: Adapter-Web], [レイヤー: Infrastructure]"
      規模感（推測）: "[SP: 3]"
      依存先（推測）: "US-004, TASK-004"
      備考: null

    - US_ID: "US-006"
      ユーザーストーリー: "システムとして、取得したHTMLコンテンツから10分毎の風況関連データ（時刻、風向文字列、風速文字列など）を正確に抽出したい。それは、後続の変換処理に必要な生データを得るためだ。"
      受け入れ基準:
        - "AC-006-01: HTML内の正しいテーブル要素から、10分ごとの観測時刻、平均風向（文字列）、平均風速(m/s)、最大瞬間風速(m/s)、最大瞬間風速の風向（文字列）が抽出される。"
        - "AC-006-02: データ項目が「///」（欠損）の場合も、その文字列として抽出される。"
        - "AC-006-03: HTML構造が予期せぬ形式でデータ抽出に失敗した場合、エラーをログに記録し、該当日の処理はスキップされる。"
      参照元要件ID: "FR-003-01, FR-003-02, UC-001 (基本フロー4d, 代替フロー5.3)"
      関連エピック: "EPIC-02"
      関連レイヤー（推測）: "[レイヤー: Adapter-Web], [レイヤー: Domain]"
      規模感（推測）: "[SP: 5]"
      依存先（推測）: "US-005, TASK-002, TASK-004"
      備考: "[分割案あり] HTML構造の複雑さによっては、テーブル特定ロジックとデータ抽出ロジックを分割検討。"

    - US_ID: "US-007"
      ユーザーストーリー: "システムとして、抽出した文字列形式の風向データを、北を0度とする数値（角度）に変換したい。それは、データを分析しやすい形式にするためだ。"
      受け入れ基準:
        - "AC-007-01: 16方位の風向文字列（例: 「北」, 「北北東」, ..., 「北西」）が、それぞれ0度, 22.5度, ..., 315度といった定義済みの角度（float）に変換される。"
        - "AC-007-02: 風向文字列が「静穏」の場合、数値 `-1.0` に変換される。"
        - "AC-007-03: 風向文字列が「///」（欠損）の場合、数値 `-1.0` に変換される。"
        - "AC-007-04: 上記以外の未定義の風向文字列が入力された場合、エラー（または警告）をログに記録し、数値 `-1.0` として扱われる。"
      参照元要件ID: "FR-004-01, FR-004-03, UC-001 (基本フロー4e)"
      関連エピック: "EPIC-03"
      関連レイヤー（推測）: "[レイヤー: Domain], [レイヤー: UseCase]"
      規模感（推測）: "[SP: 2]"
      依存先（推測）: "US-006, TASK-004"
      備考: null

    - US_ID: "US-008"
      ユーザーストーリー: "システムとして、抽出した文字列形式の風速データを数値に変換したい。それは、データを分析しやすい形式にするためだ。"
      受け入れ基準:
        - "AC-008-01: 数字の風速文字列（例: 「10.5」）が、対応するfloat値（例: 10.5）に変換される。"
        - "AC-008-02: 風速文字列が「///」（欠損）の場合、数値 `-1.0` に変換される。"
        - "AC-008-03: その他の数字以外の風速文字列が入力された場合、数値 `-1.0` に変換される。"
      参照元要件ID: "FR-004-02, UC-001 (基本フロー4f)"
      関連エピック: "EPIC-03"
      関連レイヤー（推測）: "[レイヤー: Domain], [レイヤー: UseCase]"
      規模感（推測）: "[SP: 1]"
      依存先（推測）: "US-006"
      備考: null

    - US_ID: "US-009"
      ユーザーストーリー: "システムとして、日毎に処理した10分毎の風況データを、指定された全期間にわたり時系列に統合したい。それは、期間全体の連続したデータセットを作成するためだ。"
      受け入れ基準:
        - "AC-009-01: 複数日にまたがるデータが、観測日時の昇順に正しくソートされて統合される。"
        - "AC-009-02: データ取得や解析エラーでスキップされた日のデータは、CSV上では日付・時刻列のみが記録され、他の風況データ項目は空欄（または指定の欠損値表現）として統合される。"
      参照元要件ID: "FR-005-01, UC-001 (基本フロー5)"
      関連エピック: "EPIC-04"
      関連レイヤー（推測）: "[レイヤー: UseCase], [レイヤー: Domain]"
      規模感（推測）: "[SP: 2]"
      依存先（推測）: "US-007, US-008"
      備考: null

    - US_ID: "US-010"
      ユーザーストーリー: "データ利用者として、処理・統合された風況データをUTF-8エンコーディングのCSVファイルとして出力してほしい。それは、様々な分析ツールで容易に利用できる標準的な形式だからだ。"
      受け入れ基準:
        - "AC-010-01: 統合データが、指定された（またはデフォルトの）ファイルパスにCSVファイルとして保存される。"
        - "AC-010-02: CSVファイルの文字エンコーディングはUTF-8である。"
        - "AC-010-03: CSVファイルの1行目には、定義された英語のヘッダー行が出力される。"
        - "AC-010-04: 各データ行は、観測日時、平均風向（数値）、平均風速、最大瞬間風速の風向（数値）、最大瞬間風速の順でカンマ区切りで出力される。"
        - "AC-010-05: スキップされた日のデータは、CSV上で日付・時刻列は記録され、他の風況データ項目は空欄で出力される。"
        - "AC-010-06: 出力先に同名のCSVファイルが既に存在する場合、ファイル名の末尾に連番を付与するなどの方法で別名 (`filename(1).csv`など) で保存される。"
        - "AC-010-07: ファイル書き込み権限がない場合やディスク容量不足の場合、適切なエラーメッセージがCUIに表示され、処理は終了する。エラーはログにも記録される。"
      参照元要件ID: "FR-006-01, FR-006-02, FR-006-03, FR-006-04, FR-006-05, UC-001 (基本フロー6, 7, 代替フロー5.5)"
      関連エピック: "EPIC-04"
      関連レイヤー（推測）: "[レイヤー: Adapter-File], [レイヤー: UseCase]"
      規模感（推測）: "[SP: 3]"
      依存先（推測）: "US-009, TASK-004"
      備考: null

    - US_ID: "US-011"
      ユーザーストーリー: "データ利用者として、長時間のデータ取得・処理中に、現在の処理状況（処理中の日付と残り日数）をCUIで確認したい。それは、処理がどの程度進んでいるか把握し、安心して待つためだ。"
      受け入れ基準:
        - "AC-011-01: システム起動後、処理開始を示すメッセージがCUIに表示される。"
        - "AC-011-02: 1日分のデータ処理が完了するごとに、現在処理中の日付と、総日数のうち残りの日数がCUIに表示され、情報が更新される。"
        - "AC-011-03: 全ての処理が完了後、処理完了を示すメッセージと出力されたCSVファイルパスがCUIに表示される。"
      参照元要件ID: "FR-007-01, FR-007-02, FR-007-03"
      関連エピック: "EPIC-05"
      関連レイヤー（推測）: "[レイヤー: Adapter-CUI], [レイヤー: UseCase]"
      規模感（推測）: "[SP: 2]"
      依存先（推測）: "US-001"
      備考: null

    - US_ID: "US-012"
      ユーザーストーリー: "データ利用者として、処理中にエラーが発生した場合、その旨をCUIで把握し、さらに詳細なエラー情報をログファイルで確認したい。それは、問題の原因を特定し、必要に応じて再実行や開発者へのフィードバックを行うためだ。"
      受け入れ基準:
        - "AC-012-01: HTML取得エラー、HTML解析エラー、CSV出力エラーなどが発生した場合、概要を示すエラーメッセージがCUIに表示される。"
        - "AC-012-02: 発生したエラーの詳細（日時、エラー内容、対象日など）がログファイルに記録される。"
        - "AC-012-03: 処理完了時に、エラーが1件以上ログに記録されていた場合、ログファイルの確認を促すメッセージがCUIに表示される（エラーがなければ表示されない）。"
      参照元要件ID: "FR-007-04, FR-008-01"
      関連エピック: "EPIC-05"
      関連レイヤー（推測）: "[レイヤー: Adapter-CUI], [レイヤー: Adapter-File], [レイヤー: UseCase], [レイヤー: Infrastructure]"
      規模感（推測）: "[SP: 3]"
      依存先（推測）: "TASK-004"
      備考: null

  技術的タスク_検討事項:
    - TASK_ID: "TASK-001"
      内容: "コマンドライン引数解析ライブラリ（例: Pythonの `argparse`）を導入し、必須・オプションパラメータの定義とバリデーションロジックを実装する。ヘルプメッセージ生成機能も実装する。"
      参照元要件ID: "FR-001, NFR-013"
      関連エピック: "EPIC-01"
      関連レイヤー（推測）: "[レイヤー: Adapter-CUI], [レイヤー: Infrastructure]"
      規模感（推測）: "[SP: 2]"
      依存先（推測）: null
      備考: null

    - TASK_ID: "TASK-002"
      内容: "HTML解析ライブラリ（例: `pandas.read_html`, `Beautiful Soup` + `requests`）の調査・選定と導入を行う。選定基準は、安定性・確実性を重視しつつ、迅速かつ簡単な実装が可能であること。"
      参照元要件ID: "技術的制約 (HTML解析)"
      関連エピック: "EPIC-02"
      関連レイヤー（推測）: "[レイヤー: Adapter-Web], [レイヤー: Infrastructure]"
      規模感（推測）: "[SP: 3]"
      依存先（推測）: null
      備考: "[分割案あり] PoC (Proof of Concept) を行い、対象HTMLの構造に対して各ライブラリの適合性を評価するタスクを先行させてもよい。"

    - TASK_ID: "TASK-003"
      内容: "Dockerfileを作成し、Python実行環境、依存モジュール（`pip`で管理）を含むDockerイメージを構築可能にする。開発環境と実行環境の統一を図る。"
      参照元要件ID: "技術的制約 (実行環境), NFR-016"
      関連エピック: "EPIC-06"
      関連レイヤー（推測）: "[レイヤー: Infrastructure]"
      規模感（推測）: "[SP: 2]"
      依存先（推測）: null
      備考: null

    - TASK_ID: "TASK-004"
      内容: "ロギング機能の実装。ログレベル（デフォルトINFO、設定可能）、ログフォーマット、ログファイル保存場所（実行ファイルやCSVと同じ場所）、命名規則を定義し実装する。エラー発生時の詳細情報記録を確実に行う。"
      参照元要件ID: "FR-008, NFR-015"
      関連エピック: "EPIC-05"
      関連レイヤー（推測）: "[レイヤー: Adapter-File], [レイヤー: Infrastructure]"
      規模感（推測）: "[SP: 3]"
      依存先（推測）: null
      備考: "ログローテーション機能（FR-008-03検討）は初期リリースでは見送り、必要に応じて別タスクとする。"

    - TASK_ID: "TASK-005"
      内容: "ドメインモデル（`WindDataRecord`, `DailyWindReport`, 各ValueObjectなど）のPythonクラス実装。不変性やバリデーションロジックを適切に組み込む。"
      参照元要件ID: "ドメインモデル_初期案"
      関連エピック: "EPIC-03"
      関連レイヤー（推測）: "[レイヤー: Domain]"
      規模感（推測）: "[SP: 5]"
      依存先（推測）: null
      備考: "TDDで開発を進める。"

    - TASK_ID: "TASK-006"
      内容: "`WindDataConverterService` (風向・風速変換サービス) の実装。定義された変換ルールに基づき、文字列データを対応するValueObjectに変換する。"
      参照元要件ID: "ドメインモデル_初期案, FR-004"
      関連エピック: "EPIC-03"
      関連レイヤー（推測）: "[レイヤー: Domain]"
      規模感（推測）: "[SP: 3]"
      依存先（推測）: "TASK-005"
      備考: "16方位のマッピングテーブルなど、設定データはコード内に持つか、読みやすい形で管理する。"

    - TASK_ID: "TASK-007"
      内容: "1年分のデータ取得処理の性能検証。特定の観測地点の1年分のデータを対象に、処理時間を計測し、NFR-001で定義された「現実的な時間内」および「スタックしないこと」を確認する。ボトルネックがあれば特定する。"
      参照元要件ID: "NFR-001 (性能)"
      関連エピック: "EPIC-06"
      関連レイヤー（推測）: "[レイヤー: UseCase], [レイヤー: Adapter-Web], [レイヤー: Infrastructure]"
      規模感（推測）: "[SP: 3]"
      依存先（推測）: "主要な機能がほぼ実装完了後"
      備考: null

    - TASK_ID: "TASK-008"
      内容: "気象庁ウェブサイトの利用規約および `robots.txt` の内容を確認し、システムがこれらを遵守していることを確認する。（特にrobots.txtはURLが分かれば確認可能）"
      参照元要件ID: "制約条件_前提条件 (運用上の制約), NFR-005"
      関連エピック: "EPIC-02, EPIC-06"
      関連レイヤー（推測）: "[レイヤー: Adapter-Web]"
      規模感（推測）: "[SP: 1]"
      依存先（推測）: null
      備考: "開発初期に実施。"

    - TASK_ID: "TASK-009"
      内容: "テスト戦略の策定とテストコード実装。ユニットテスト（ドメインロジック、変換ロジック等）、結合テスト（CUIからのパラメータ渡し～ファイル出力までの一連の流れ）、受け入れテスト（主要シナリオ）を計画し実装する。外部APIアクセス部分はモック化する。"
      参照元要件ID: "NFR-010, NFR-011, NFR-012"
      関連エピック: "EPIC-06"
      関連レイヤー（推測）: "[レイヤー: Domain], [レイヤー: UseCase], [レイヤー: Adapter-CUI], [レイヤー: Adapter-Web], [レイヤー: Adapter-File]"
      規模感（推測）: "[SP: 8]"
      依存先（推測）: "各機能の実装"
      備考: "[分割案あり] 各レイヤー、各機能単位でテスト実装タスクを分割する。 継続的なテスト実施。"

  補足_確認_検討事項:
    - "CSVの空欄表現: エラーでスキップされた日のデータ項目を「空欄」としましたが、CSVファイル上で具体的にどのように表現しますか？（例: `,,` のように値がない状態、あるいは `「」` のように空文字列を明示的に入れるかなど。Pandas等ライブラリのデフォルト挙動も考慮）"
    - "別名保存の具体的な命名規則: 同名ファイル存在時に「別名で保存」としましたが、具体的な命名規則はありますか？（例: `filename(1).csv`, `filename(2).csv` で良いか、あるいはタイムスタンプを付与するなど）"
    - "スタック時のタイムアウト値: 非機能要件NFR-001で「スタックしたと判断される場合（例: タイムアウト設定）、エラーとして扱いスキップ処理を行う」とありますが、1日分の処理に対する具体的なタイムアウト値の目安はありますか？"
    - "ログレベル設定方法: 機能要件FR-008-02で「ログレベル設定可能」としましたが、コマンドラインオプションで指定する形式でよろしいでしょうか？"
    - "HTML構造変更時の具体的なエラーメッセージ: HTML構造変更でデータ抽出に失敗した場合、ユーザーにはどのようなエラーメッセージ（CUIおよびログ）を伝えるのが最も分かりやすいでしょうか？（例: 「XX地点のYYYY-MM-DDのデータ形式が予期したものではありませんでした。サイトの構造が変更された可能性があります。」など）"