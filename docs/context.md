## システムコンテキスト定義書：風況データ収集・統合システム 
### 1. 背景と目的 (Why)

* **課題:**
    * 気象庁のウェブサイトでは、特定の観測地点における10分毎の風況データが公開されていますが、これらはHTML形式の表として日単位で提供されています。他の気象項目（相対湿度、日照時間など）も同ページに記載されていますが、今回のシステムでは不要です。
    * 特定の地点における長期間（例：1年間）の風況データを分析・利用するためには、これらの日次データをウェブページから手動で一つずつ確認し、必要な情報（風向・風速関連のみ）を抽出し、さらに風向データを分析に適した数値形式に変換した上で統合する必要があり、多大な時間と手間を要します。
    * 手作業による収集・変換は、ヒューマンエラーのリスクも伴い、長時間の処理となるため実行中の状況把握も困難です。
    * データ取得元のウェブサイトに過度な負荷をかけることは避けるべきであり、適切なアクセス間隔を保つ必要があります。
* **構想:**
    * 指定された観測地点の風況データ（風向・風速関連のみ）を、気象庁のウェブサイトから、サーバー負荷に配慮した適切な間隔（ユーザーがコマンドラインで設定可能、デフォルト5秒、最低3秒）を空けて自動的に1日ずつ取得し、風向データを北基準の数値に変換した上で、指定された期間（本件では1年間）のデータとして統合し、CSV形式のファイルとして出力する、コマンドラインインターフェース（CUI）ベースのシステムを構想します。開発はPythonで行い、Dockerコンテナ上で動作させることを想定します。処理中の進捗はCUIに表示します。
* **目的:**
    * 特定地点における1年分の10分毎風況データ（具体的には時刻、数値化された風向、平均風速、数値化された最大瞬間風速の風向、最大瞬間風速など）を、効率的かつ正確に、かつデータ提供元に配慮しながら収集・変換・統合し、分析しやすいCSV形式で準備すること。
    * 手作業によるデータ収集・変換・統合の負荷を大幅に軽減し、ヒューマンエラーを排除すること。
    * 収集したデータを、後続の分析や様々な用途に活用しやすくすること。
    * 利用者が処理状況を把握できるようにすることで、安心感と利便性を提供すること。

### 2. 提供価値 (Value)

* **効率向上:**
    * データ収集・変換・統合プロセスの自動化により、作業時間を大幅に短縮します。
* **データ品質向上:**
    * 自動処理により、手作業に起因するミスを防ぎ、データの正確性と完全性を高めます。
    * 風向データを一貫したルールに基づき数値化することで、分析の精度と容易性を向上させます。
* **データ活用促進:**
    * 長期間の風況データが、標準的なCSV形式で一元的に整理され、かつ風向が数値化されることで、分析がより高度かつ容易になります。
* **再現性の確保:**
    * データ収集・変換プロセスがシステム化されることで、再現性をもって同じ品質のデータを取得できます。
* **データ提供元への配慮:**
    * 適切なアクセス間隔を設けることで、ウェブサイトへの負荷を低減します。
* **自動化・連携の容易性:**
    * CUIベース、CSV出力のため、他の処理との連携や定期実行が容易です。
* **ユーザビリティ向上:**
    * 処理の進捗状況をCUIに表示することで、利用者は実行状況を把握でき、長時間の処理でも安心して待つことができます。
* **開発・運用の効率化:**
    * Pythonと主要ライブラリの活用、Dockerによる開発・実行環境のコンテナ化により、迅速な開発と環境構築の容易性を目指します。

### 3. 主要な関係者 (Who)

* **アクター:**
    * **データ利用者 (User):**
        * 役割: コマンドラインインターフェースを通じて、システムに対して対象地点、期間、データ取得間隔等を指定し、統合された数値化風況データをCSVファイルとして取得する人。処理中の進捗状況をCUIで確認する。
        * 想定: コマンドライン操作に慣れた研究者、気象コンサルタント、エネルギー関連企業の担当者、データ分析者など。
    * **当システム (This System):**
        * 役割: 指定されたパラメータに基づき、気象庁ウェブサイトから、定義されたアクセス間隔を遵守して日次データを取得し、風向データを数値に変換後、1年分のデータに統合してCSVファイルとして出力する、Pythonで開発されたCUIシステム。処理進捗をCUIに表示する。
    * **気象庁ウェブサイト (Data Source System):**
        * 役割: 風況データの提供元。
* **ステークホルダー:**
    * **データ利用者の所属組織:**
        * 利害: 収集されたデータの品質、収集効率、データ活用による業務成果に関心を持つ。
    * **(広義には) 気象庁:**
        * 利害: 提供データの適切な利用、サーバーへの過度な負荷回避などに関心を持つ。

### 4. システムの責務と範囲 (What)

* **主要機能:**
    * **コマンドラインインターフェース(CUI)によるパラメータ設定機能:** データ利用者が、コマンドライン引数やオプション等を用いて、対象地点、期間、データ取得間隔、出力ファイルパス等を指定できる機能。
    * **日次風況データ自動取得機能:** 指定されたパラメータに基づき、気象庁ウェブサイトのURLを動的に生成し、該当ページのHTMLコンテンツを取得。HTML内の表構造から、1日単位で10分毎の風況関連データを抽出・取得する機能。各リクエスト間には、ユーザー指定またはデフォルトの待機時間を設ける。
    * **風向データ数値変換機能:** 抽出した風向データ（文字列）を、北を0度とする数値（角度など）に変換する機能。
    * **データ統合機能:** 数値変換後の風況データを時系列に沿って結合し、指定された期間の連続したデータセットを作成する機能。
    * **CSVデータ出力機能:** 統合したデータを、CSV形式のファイルとして指定されたパスに出力・保存する機能。
    * **進捗表示機能:** データ取得・処理の進行状況（例: 現在処理中の日付、完了した日数の割合など）をCUIに表示する機能。
* **スコープ (責任範囲):**
    * コマンドラインインターフェースを通じた操作。
    * データ取得間隔をコマンドラインで設定可能（デフォルト5秒、下限3秒）。
    * 処理進捗のCUIへの表示。
    * 気象庁の公開する特定のURLパターンから風況データを含むHTMLページを、定義されたアクセス間隔を遵守して取得すること。
    * URLパラメータに基づき、指定された地点・期間のデータを網羅的に収集すること。
    * 取得したHTMLページ内の表データから、指定された風況関連項目を10分毎の粒度で正確に抽出すること。
    * 抽出した風向文字列を、事前に定義されたルールに従って数値データに変換すること。
    * 収集・変換・統合した結果を、CSV形式のファイルとして出力すること。
    * Python言語で開発され、Dockerコンテナ上で動作することを前提とする。
* **範囲外 (責任範囲外):**
    * グラフィカルユーザーインターフェース（GUI）の提供。
    * CSV形式以外のファイル出力サポート（標準機能として）。
    * 風況データ以外の気象データ取得。
    * 3秒未満のリクエスト間隔での動作。
    * 取得した風況データの高度な統計分析、可視化、予測モデリング機能。
    * 都道府県番号(prec\_no)や地点番号(block\_no)の探索・特定支援機能。
    * 気象庁ウェブサイト側の仕様変更への完全自動追従。
    * 気象庁ウェブサイトの利用規約に反するような過度な頻度でのアクセス。
    * データの解釈や、それに基づく具体的な意思決定支援。
    * 本システム専用以外の目的での開発環境（Dockerイメージ）の流用サポート。

### 5. 重要な要素 (How/Constraints)

* **主要データ:**
    * **入力データ (コマンドライン経由):**
        * 都道府県番号 (prec\_no)
        * 地点番号 (block\_no)
        * 取得開始年月日 (year, month, day)
        * 取得期間 (例: 365日) または 取得終了年月日
        * (オプション) データ取得間隔（秒数、デフォルト5秒、下限3秒）
        * (オプション) 出力CSVファイルパス
    * **処理中データ:**
        * HTML形式のウェブページコンテンツ。
        * 抽出された10分毎の生データ。
        * 数値に変換された風向データ。
    * **出力データ:**
        * 指定された期間の10分毎風況データを格納したCSVファイル。
* **制約・前提条件:**
    * **技術的制約:**
        * **開発言語:** Python。
        * **実行環境:** Dockerコンテナ。依存モジュールは `pip` で管理。
        * **HTML解析:** Pythonのライブラリ（例: `pandas.read_html`, `Beautiful Soup` + `requests` 等）を利用。選定は、安定性・確実性を重視しつつ、迅速かつ簡単な実装を優先する。
        * システムはコマンドラインから実行可能な形式で提供される。
        * コマンドライン引数・オプション解析処理。
        * HTTP(S)アクセス機能。
        * **リクエスト間隔制御:** プログラム上でユーザー指定またはデフォルトの待機時間（デフォルト5秒、下限3秒）を挿入。
        * **風向変換ロジックの実装:** 文字列から数値へのマッピングルールと処理。
        * **CSVファイル生成:** データをCSV形式にフォーマットし出力。
        * **進捗表示ロジック:** 処理の進捗を計算し、標準出力に表示する処理。
        * 長期間のデータを扱うための効率的なデータ処理とストレージ考慮。
    * **運用上の制約:**
        * **利用者のスキル:** コマンドラインの基本的な操作に習熟。
        * **気象庁ウェブサイトへの負荷配慮:** 定義されたアクセス間隔を厳守。
        * 外部仕様変更時のメンテナンス可能性。
        * 定期実行や他スクリプトからの呼び出しを想定した設計。
    * **データに関する前提:**
        * 気象庁提供データの形式・精度に依存。
        * 文字列データの適切な型変換。
        * 風向変換ルールの網羅性（欠測値「///」や「静穏」等への対応含む）。
    * **予算・期間 (推測):**
        * Python、主要ライブラリ、Dockerの活用により、CUIベースのシステムを迅速かつ効率的に開発することを目指す。GUI開発や特殊なファイル形式対応のコストは不要。
