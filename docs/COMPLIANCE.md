## JMAアクセス指針 (改訂版)

**バージョン:** 1.0
**最終更新日:** {本日の日付 YYYY-MM-DD}
**策定経緯:** `TASK-008`調査報告書および`robots.txt`が存在しないという確定情報に基づき、`TASK-ACCESS-POLICY-01`の議論を経て策定。

### 1. User-Agent文字列

* **User-Agent文字列:** `WindResearcher/1.0 (+mailto:wind-researcher@example.com)`
* **バージョニング方針:**
    * バージョン `1.0` は、本システムのこのイテレーションにおける固定値とします。
    * 将来的にシステムのスクレイピング動作や目的に大幅な変更が加えられる場合は、User-Agent文字列内のバージョン番号を更新することを検討します。この変更は、意図的かつ文書化されたプロセス（例: 新たなポリシー改訂）を経て行われるべきです。オペレーターが場当たり的に書き換えることは想定していません。
* **目的:** システムのアクセス元を気象庁側が識別できるようにし、透明性を確保するとともに、万が一問題が発生した場合の連絡手段を提供するため。

### 2. アクセス間隔のシステム内部最小値

以下のアクセス間隔は、システムが強制する各ドメインへのリクエスト間の**最小待機時間**です。ユーザーがコマンドラインオプションでこれより短い間隔を指定した場合でも、ここで定義されたシステム最小値が優先されます。

* **`data.jma.go.jp`ドメイン:**
    * **アクセス間隔の最小値:** **8秒**
    * **根拠:** 当該ドメインの「過去の気象データ・ダウンロード」ページにある「自動化ツール等による過度のアクセスはお控えいただくようお願いいたします。」という警告文を最重視し、サーバー負荷を最大限に配慮するため。
* **`www.jma.go.jp`ドメイン:**
    * **アクセス間隔の最小値:** **3秒**
    * **根拠:** こちらは風況データの主たる取得元ではないものの、関連情報取得でアクセスする可能性を考慮。`data.jma.go.jp`ドメインほど厳格な警告は確認されていませんが、一般的なウェブスクレイピングのマナーとして節度あるアクセスを維持するため。

### 3. エラーハンドリング方針（基本的なアクセス関連）

気象庁ウェブサイトへのアクセス時に以下のクリティカルなエラーを検知した場合、サーバーへの継続的な負荷を避け、問題を明確にするため、原則として現在のデータ収集処理全体を停止します。

* **対象エラー:**
    * `HTTP 503 Service Unavailable`
    * `HTTP 429 Too Many Requests`
    * 接続タイムアウト (Connection Timeout)
* **処理方針:**
    1.  **エラー情報の記録:** 発生したエラーに関する詳細情報をログファイルに記録します。
    2.  **コンソールへの通知:** 作業者が問題を即座に認識できるよう、エラーの概要（エラー種別、可能であれば対象URL）をコンソールに表示します。
    3.  **処理の停止:** 現在実行中のデータ収集・統合プロセス全体を安全に停止します。
* **ログレベル:**
    * 上記対象エラーのログレベルは **`ERROR`** とします。
* **ログ内容 (最低限含めるべき情報):**
    * 発生日時 (Timestamp, ISO 8601形式推奨)
    * エラー種別 (例: "HTTP 503 Service Unavailable", "Connection Timeout")
    * アクセス試行対象のURL
    * HTTPステータスコード (該当する場合)
    * サーバーからのエラーメッセージ本文 (取得できた場合、かつログ記録が安全な内容である場合)
    * システム内部のエラーメッセージやコンテキスト (例: "データ取得処理中のYYYY-MM-DDのHTMLフェッチに失敗")
* **「処理停止」選択の理由:**
    * これらのエラーは、サーバー側の高負荷状態やアクセス制限を示唆している可能性が高いです。このような状況でリトライや処理を継続することは、問題を悪化させたり、意図せずサービス妨害行為とみなされたりするリスクがあります。
    * 現行バージョンでは、システムの複雑性を抑え、より安全側に倒した運用を優先するため、即時停止の方針とします。利用者はログを確認し、時間を置いて手動で再実行するか、アクセスパラメータを見直す必要があります。
    * 将来的な改訂で、より洗練されたリトライ戦略（指数バックオフ、冷却期間の設定など）の導入を検討する可能性はありますが、その際は効果とリスクを慎重に評価します。

### 4. アクセス対象パスの原則

`robots.txt`が存在しないため、アクセスするパスは以下の原則に基づき、慎重に決定・管理します。

* **原則:**
    * システムからのアクセスは、**一般に公開されており、人間が通常のウェブブラウザで閲覧することを主たる目的として提供されているHTMLページ**に限定します。
    * 本システムの具体的な取得対象は、気象庁が提供する10分間隔の風況データが表示されるページ（例: `/stats/etrn/view/10min_a1.php` およびそのデータ指定に必要なクエリパラメータ）です。
* **禁止事項:**
    * 管理用インターフェース、非公開APIエンドポイント（気象庁によって公式に利用が許可・文書化されている場合を除く）、その他データ表示を主目的としないパスへのアクセスは行いません。
    * ウェブサイトの構造を不必要に広範囲に探索するような動作は行いません。
* **担保方法:**
    * システム内のURL生成ロジックは、上記原則を逸脱しないよう厳密に設計・実装します。
    * URL生成ロジックについては、コードレビュー (`TASK-URL-REVIEW-01-MODIFIED`) を通じてその妥当性を複数人で確認します。

### 5. 利用規約および出典の明記

* 気象庁の定める「公共データ利用規約（第1.0版）」および関連する全ての利用条件を遵守します。
* 本システムを用いて取得・処理したデータを利用する際は、気象庁のガイドラインに従い、適切に出典を明記することが推奨されます。具体的な推奨表記については、ユーザー向けドキュメント (`TASK-ATTRIBUTION-DOC-01`で作成) を参照してください。
